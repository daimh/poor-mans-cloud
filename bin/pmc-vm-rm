#!/usr/bin/env bash
. /etc/pmc.conf
Force=No
OPTS=$(getopt -o hvf --long help,version,force -n "$(basename $0)" -- "$@")
eval set -- "$OPTS"
while [ $# -gt 0 ]
do
	case "$1" in
#@ HELP_START
#@ NAME
#@ 	pmc-vm-rm - remove a virtual machine (VM)
#@ SYNOPSIS
#@ 	pmc-vm-rm [OPTION]... VM
#@ EXAMPLES
#@ 	pmc-vm-rm wsus
#@ DESCRIPTION
		-h | --help) #@ display this help message and exit
			die ;;
		--version) #@ display version information and exit
			die 20251206 ;;
		-v | --verbose) #@ enable verbose output
			VERBOSE="set -x"
			$VERBOSE
			shift ;;
		-f | --force) #@ remove the VM without prompting for confirmation
			Force=Yes
			shift ;;
		--)
			[ $# -eq 2 ] || die "ERR-3001: VM is missing"
			VM=$2
			shift 2
			break ;;
		*)
			break ;;
#@ AUTHOR
#@ 	Manhong Dai <manhongdai@gmail.com>
#@ COPYRIGHT
#@	Copyright Â© 2020-2025 University of Michigan. MIT License.
#@	This is free software: you are free to use, modify, and redistribute it
#@	under the terms of the MIT License. There is NO WARRANTY, to the extent
#@	permitted by law.
#@ HELP_END
	esac
done
if [ $# -ne 0 ]
then
	die "ERR-3002: use -h/--help"
fi
if [ "$Force" != Yes ]
then
	read -p "Deleting \"$VM\", type \"$VM\" to confirm: " ANS
	if [ "$ANS" != "$VM" ]
	then
		echo "# Quit"
		exit 1
	fi
fi

##Set/Get IP and Mac
for PM in ${PM_LIST[@]}
do
	echo "# Checking $PM"
	delete_vm_from_pm $VM $PM
done
